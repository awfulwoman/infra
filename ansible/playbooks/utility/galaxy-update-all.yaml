- name: Update ansible galaxy roles and collections on all hosts
  hosts: regular
  tasks:
    - name: Run initial requirements install - collections
      ansible.builtin.command: "ansible-galaxy collection install -r {{ ansible_path }}/{{ repo_name }}/ansible/meta/requirements.yaml"
      timeout: 3600 # stupidly long value because ansible-galaxy installation takes FOREVER
      register: galaxy_install

    - name: Debug galaxy collections install
      ansible.builtin.debug:
        var: galaxy_install

    - name: Delete home dir ansible
      ansible.builtin.file:
        path: "/home/{{ ansible_user }}/.ansible"
        state: absent

    - name: Delete home dir ansible
      ansible.builtin.file:
        path: "/home/{{ ansible_user }}/ansible"
        state: absent

  handlers:
    - name: Reboot host
      become: true
      ansible.builtin.reboot:
