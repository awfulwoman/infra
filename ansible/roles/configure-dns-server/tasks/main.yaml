# Install BIND via apt
- name: Install BIND
  ansible.builtin.apt:
    name: bind9
    state: present

# Copy over templates
- name: Copy named.conf.options
  ansible.builtin.template:
    src: named.conf.options
    dest: /etc/bind/named.conf.options
    owner: root
    group: bind
    mode: '0644'

- name: Ensure zone file exists
  ansible.builtin.template:
    src: db.zone
    dest: /etc/bind/db.{{ bind_local_domain }}.zone
    owner: root
    group: bind
    mode: '0644'

- name: Ensure reverse zone file exists
  ansible.builtin.template:
    src: db.reverse.zone
    dest: /etc/bind/db.{{ bind_local_domain }}.zone
    owner: root
    group: bind
    mode: '0644'

# Ensure firewall is open for DNS
- name: Open DNS port in firewall
  community.general.ufw:
    rule: allow
    name: 'DNS Server'
    port: '53'
    proto: 'tcp'

# Start named

