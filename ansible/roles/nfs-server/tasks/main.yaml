- name: Install NFS packages
  become: true
  ansible.builtin.apt:
    name:
      - nfs-common
      - nfs-kernel-server
    state: present

# - name: Gather facts about ZFS dataset
#   ansible.builtin.stat:
#     path: "{{ restic_server_path }}"
#   register: restic_server_path_status

- name: Share ZFS datasets via NFS
  become: true
  community.general.zfs:
    name: "{{ nfsshare.dataset }}"
    state: present
    extra_zfs_properties:
      sharenfs: "{{ nfsshare.options }}"
  loop_control:
    loop_var: nfsshare
  loop: "{{ zfs_nfs_exports }}"
  when: (zfs_nfs_exports is defined)
