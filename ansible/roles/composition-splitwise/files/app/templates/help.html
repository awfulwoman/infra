{% extends "base.html" %}

{% block title %}Help - Splitwise{% endblock %}

{% block content %}
<div class="help-page">
    <h1>Splitwise Help</h1>

    <div class="help-section">
        <h2>Web Application Guide</h2>

        <div class="help-topic">
            <h3>Getting Started</h3>
            <p>Splitwise helps you track shared expenses and split costs between people in groups.</p>
            <ol>
                <li>Register an account or log in</li>
                <li>Create a group and add members</li>
                <li>Start adding expenses and recording payments</li>
            </ol>
        </div>

        <div class="help-topic">
            <h3>Creating Groups</h3>
            <p>Groups are collections of people who share expenses together.</p>
            <ol>
                <li>Go to the Groups page</li>
                <li>Click "Create Group"</li>
                <li>Enter a group name (e.g., "Holiday 2026", "Apartment 4B")</li>
                <li>Select at least 2 members (including yourself)</li>
                <li>Click "Create Group"</li>
            </ol>
        </div>

        <div class="help-topic">
            <h3>Adding Expenses</h3>
            <p>Record shared costs that need to be split between group members.</p>
            <ol>
                <li>Open a group</li>
                <li>Click "Add Expense"</li>
                <li>Enter description (e.g., "Dinner at restaurant")</li>
                <li>Enter amount in euros</li>
                <li>Select who paid</li>
                <li>Choose split method:
                    <ul>
                        <li><strong>Equal split</strong> - Divides evenly among all members</li>
                        <li><strong>By percentage</strong> - Specify what % each person owes (must total 100%)</li>
                        <li><strong>Custom amounts</strong> - Enter exact euro amounts per person (must sum to total)</li>
                    </ul>
                </li>
                <li>Click "Add Expense"</li>
            </ol>
        </div>

        <div class="help-topic">
            <h3>Recording Payments</h3>
            <p>Track when someone pays back what they owe.</p>
            <ol>
                <li>Open a group</li>
                <li>Click "Record Payment"</li>
                <li>Select who paid (From)</li>
                <li>Select who received the payment (To)</li>
                <li>Enter the amount</li>
                <li>Click "Record Payment"</li>
            </ol>
            <p><em>Tip: Payments don't split among the group - they directly reduce debt between two people.</em></p>
        </div>

        <div class="help-topic">
            <h3>Editing and Deleting Transactions</h3>
            <p>Fix mistakes or update transaction details.</p>
            <ul>
                <li>Click the ‚úèÔ∏è (edit) button on any transaction</li>
                <li>Update description, amount, payer, or split method</li>
                <li>Click "Save Changes"</li>
                <li>To delete: Click the üóëÔ∏è (delete) button and confirm</li>
            </ul>
        </div>

        <div class="help-topic">
            <h3>Understanding Balances</h3>
            <p>Each group shows member balances:</p>
            <ul>
                <li><strong>Positive balance (+)</strong> - This person is owed money</li>
                <li><strong>Negative balance (-)</strong> - This person owes money</li>
                <li><strong>‚Ç¨0.00</strong> - This person is settled up</li>
            </ul>
            <p><em>Note: All balances in a group always sum to zero.</em></p>
        </div>
    </div>

    <div class="help-section">
        <h2>API Documentation</h2>

        <div class="help-topic">
            <h3>Authentication</h3>
            <p>All API requests require authentication using a Bearer token.</p>
            <pre><code>Authorization: Bearer YOUR_API_TOKEN</code></pre>
            <p>You can find your API token on the <a href="/account">Account page</a>.</p>
        </div>

        <div class="help-topic">
            <h3>Base URL</h3>
            <pre><code>https://{{ request.url.netloc }}/api/v1</code></pre>
        </div>

        <div class="help-topic">
            <h3>Endpoints</h3>

            <h4>List Groups</h4>
            <pre><code>GET /groups

Response:
[
  {
    "id": "uuid",
    "name": "Holiday 2026",
    "members": ["user_id1", "user_id2"],
    "created_at": "2026-02-15T10:00:00Z"
  }
]</code></pre>

            <h4>Create Group</h4>
            <pre><code>POST /groups
Content-Type: application/json

{
  "name": "Weekend Trip",
  "members": ["user_id1", "user_id2", "user_id3"]
}

Response: 201 Created
{
  "id": "new_group_uuid",
  "name": "Weekend Trip",
  "members": ["user_id1", "user_id2", "user_id3"],
  "created_at": "2026-02-16T15:00:00Z"
}</code></pre>

            <h4>List Transactions</h4>
            <pre><code>GET /groups/{group_id}/transactions

Response:
[
  {
    "id": "uuid",
    "group_id": "group_uuid",
    "description": "Dinner",
    "amount": 60.00,
    "currency": "EUR",
    "payer_id": "user_id1",
    "split_type": "equal",
    "split_details": {
      "user_id1": 20.00,
      "user_id2": 20.00,
      "user_id3": 20.00
    },
    "created_at": "2026-02-16T19:00:00Z"
  }
]</code></pre>

            <h4>Create Transaction (Equal Split)</h4>
            <pre><code>POST /groups/{group_id}/transactions
Content-Type: application/json

{
  "description": "Groceries",
  "amount": 45.50,
  "payer_id": "user_id1",
  "currency": "EUR",
  "split_type": "equal"
}

Response: 201 Created</code></pre>

            <h4>Create Transaction (Percentage Split)</h4>
            <pre><code>POST /groups/{group_id}/transactions
Content-Type: application/json

{
  "description": "Taxi",
  "amount": 30.00,
  "payer_id": "user_id1",
  "currency": "EUR",
  "split_type": "percentage",
  "custom_splits": {
    "user_id1": 33.33,
    "user_id2": 33.33,
    "user_id3": 33.34
  }
}

Response: 201 Created</code></pre>

            <h4>Create Transaction (Custom Amounts)</h4>
            <pre><code>POST /groups/{group_id}/transactions
Content-Type: application/json

{
  "description": "Supplies",
  "amount": 100.00,
  "payer_id": "user_id1",
  "currency": "EUR",
  "split_type": "custom",
  "custom_splits": {
    "user_id1": 25.00,
    "user_id2": 50.00,
    "user_id3": 25.00
  }
}

Response: 201 Created</code></pre>

            <h4>Record Payment</h4>
            <pre><code>POST /groups/{group_id}/transactions
Content-Type: application/json

{
  "description": "Payment from Alice to Bob",
  "amount": 50.00,
  "payer_id": "alice_user_id",
  "recipient_id": "bob_user_id",
  "currency": "EUR",
  "split_type": "payment"
}

Response: 201 Created</code></pre>

            <h4>Update Transaction</h4>
            <pre><code>PUT /transactions/{transaction_id}
Content-Type: application/json

{
  "description": "Updated description",
  "amount": 55.00,
  "payer_id": "user_id2",
  "split_type": "equal"
}

Response: 200 OK</code></pre>

            <h4>Delete Transaction</h4>
            <pre><code>DELETE /transactions/{transaction_id}

Response: 204 No Content</code></pre>
        </div>

        <div class="help-topic">
            <h3>Error Responses</h3>
            <pre><code>400 Bad Request - Invalid input data
401 Unauthorized - Missing or invalid token
403 Forbidden - Not a member of the group
404 Not Found - Resource doesn't exist
500 Internal Server Error - Server error</code></pre>
        </div>

        <div class="help-topic">
            <h3>Example: Using curl</h3>
            <pre><code># List your groups
curl -H "Authorization: Bearer YOUR_TOKEN" \
  https://{{ request.url.netloc }}/api/v1/groups

# Add an expense
curl -X POST \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "description": "Coffee",
    "amount": 12.50,
    "payer_id": "your_user_id",
    "currency": "EUR",
    "split_type": "equal"
  }' \
  https://{{ request.url.netloc }}/api/v1/groups/GROUP_ID/transactions</code></pre>
        </div>
    </div>

    <div class="help-section">
        <h2>Tips & Best Practices</h2>
        <ul>
            <li>Use descriptive names for expenses to remember what they were for</li>
            <li>Record expenses as soon as they happen to avoid forgetting</li>
            <li>Settle debts regularly to keep balances manageable</li>
            <li>Use percentage splits when costs should be divided unequally (e.g., 70/30)</li>
            <li>Use custom amounts when specific people owe specific amounts</li>
            <li>Double-check amounts before submitting - you can always edit later</li>
        </ul>
    </div>

    <div class="help-section">
        <h2>MQTT Integration</h2>
        <p>Splitwise publishes balance updates to MQTT with Home Assistant auto-discovery.</p>
        <ul>
            <li><strong>Discovery topic:</strong> <code>homeassistant/sensor/splitwise_{group_id}_{user_id}/config</code></li>
            <li><strong>State topic:</strong> <code>splitwise/{group_id}/state</code></li>
        </ul>
        <p>Balance sensors automatically appear in Home Assistant when transactions are created or updated.</p>
    </div>
</div>
{% endblock %}
