#cloud-config
disable_root: true
users:
  - name: {{ ansible_user }}
    sudo: "ALL=(ALL) NOPASSWD:ALL"
    groups: users, adm, sudo
    ssh_import_id:
      - gh:awfulwoman
    lock_passwd: true
# packages:
#   - fail2ban
#   - ufw
# package_update: true
# package_upgrade: true
# write_files:
#   - path: /etc/ssh/sshd_config.d/ssh-hardening.conf
#     content: |
#       PermitRootLogin no
#       PasswordAuthentication no
#       Port 2222
#       KbdInteractiveAuthentication no
#       ChallengeResponseAuthentication no
#       MaxAuthTries 2
#       AllowTcpForwarding no
#       X11Forwarding no
#       AllowAgentForwarding no
#       AuthorizedKeysFile .ssh/authorized_keys
#       AllowUsers {{ ansible_user }}
# runcmd:
#   - printf "[sshd]\nenabled = true\nport = ssh, 2222\nbanaction = iptables-multiport" > /etc/fail2ban/jail.local
#   - systemctl enable fail2ban
#   - ufw allow 2222
#   - ufw enable
#   - reboot
