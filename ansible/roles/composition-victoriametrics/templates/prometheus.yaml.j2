global:
  scrape_interval: {{ composition_victoriametrics_scrape_interval }}
  scrape_timeout: {{ composition_victoriametrics_scrape_timeout }}
  external_labels:
    environment: 'homelab'
    monitor: 'victoriametrics'

scrape_configs:
  # ZFS API metrics from all hosts in the 'zfs' inventory group
  - job_name: 'zfs-metrics'
    scrape_interval: {{ composition_victoriametrics_scrape_interval }}
    metrics_path: '/metrics'
    scheme: 'https'
    tls_config:
      insecure_skip_verify: true
    static_configs:
      - targets:
{% for host in composition_victoriametrics_scrape_targets %}
          - 'zfs-api.{{ host }}.{{ domain_name }}:443'
{% endfor %}
        labels:
          job: 'zfs'
          service: 'zfs-api'

  # VictoriaMetrics self-monitoring
  - job_name: 'victoriametrics'
    static_configs:
      - targets:
          - 'localhost:8428'
        labels:
          job: 'victoriametrics'
          service: 'monitoring'
