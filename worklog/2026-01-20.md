# 2026-01-20

## Session Overview
Configured Belinda host networking and improved Tailscale/netplan roles for better default behavior.

## What Was Done

- **Configured Belinda host**
  - Updated IP address to `192.168.1.173`
  - Cleaned up playbook naming and formatting
  - Preparation work for ZFS backup server role

- **Enhanced netplan role with default DNS**
  - Added default DNS nameserver (`192.168.1.1` - gateway) to netplan configurations
  - Ensures DNS resolution works out of the box
  - Prevents common networking issue where hosts have connectivity but no name resolution
  - Applied to all hosts using netplan-based network configuration

- **Fixed Tailscale exit node handling**
  - Corrected condition to properly handle both undefined and explicitly false values
  - Previous logic didn't distinguish between "not set" and "set to false"
  - Now regular Tailscale setup runs when exit node mode is disabled
  - Ensures hosts can join Tailscale network without becoming exit nodes

- **Documented operating systems rationale**
  - Added documentation explaining OS choices for infrastructure
  - Captures reasoning for Ubuntu Server selection
  - Provides context for future infrastructure decisions

## Key Decisions

1. **Set gateway as default DNS** in netplan configs
   - Reason: Most home networks have router at .1 providing DNS
   - Impact: Reduces manual configuration needed per host
   - Trade-off: Assumes standard network topology

2. **Fix Tailscale boolean logic** instead of documenting workaround
   - Reason: Ansible should handle false/undefined gracefully
   - Impact: More intuitive configuration behavior
   - Alternative rejected: Requiring explicit `tailscale_exit_node: false` in all configs

3. **Document OS choices** in formal documentation
   - Reason: Capture institutional knowledge about infrastructure decisions
   - Impact: Easier onboarding and consistent future choices

## Files Changed

- `ansible/inventory/host_vars/belinda/core.yaml`
  - Updated `host_ipv4` to `192.168.1.173`

- `ansible/playbooks/baremetal/belinda/core.yaml`
  - Style cleanup and naming improvements

- `ansible/roles/network-netplan/tasks/main.yaml`
  - Added default DNS nameserver configuration
  - Sets `nameservers.addresses: [192.168.1.1]` when not overridden

- `ansible/roles/network-tailscale/tasks/main.yaml`
  - Fixed condition: `when: tailscale_exit_node is not defined or not tailscale_exit_node`
  - Properly handles false values and undefined variables

- `docs/operating-systems.md` (new)
  - Rationale for Ubuntu Server selection
  - Considerations for other OS choices

## Current State

- âœ… Belinda configured with correct IP address
- âœ… Netplan role provides sensible DNS defaults
- âœ… Tailscale role handles exit node configuration correctly
- âœ… Operating system choices documented
- ðŸ”„ Ready for ZFS pool configuration on Belinda

## Next Steps

1. **Set up ZFS pools on Belinda**
   - Configure mirrored 2TB drives
   - Create backup dataset structure

2. **Deploy backup server roles to Belinda**
   - Install backup scripts
   - Configure SSH keys
   - Set up cronjobs

3. **Test DNS resolution** on newly configured hosts
   - Verify default DNS works as expected
   - Confirm no manual DNS configuration needed

## Notes

- **DNS Default**: The `192.168.1.1` default works for most home networks but can be overridden in host_vars if needed

- **Tailscale Exit Nodes**: Exit node functionality allows a Tailscale host to route internet traffic for other devices on the network. Most hosts should NOT be exit nodes.

- **Belinda IP**: The IP change from `192.168.1.117` to `192.168.1.173` likely reflects network reorganization or DHCP reservation updates

- **Boolean Handling**: Ansible's truthiness can be tricky - `false` and `undefined` need explicit handling in conditionals

- **Playbook Cleanup**: Style improvements make playbooks more consistent and easier to read

## Commits

- `8c595dbf` - chore: update belinda IP address to 192.168.1.173
- `a2ac3eb1` - style: clean up belinda playbook naming and formatting
- `a4ad3680` - fix: handle tailscale_exit_node false values correctly
- `91f6c3bc` - feat: add default DNS nameserver to netplan role
- `367bbca0` - docs: add operating systems rationale
